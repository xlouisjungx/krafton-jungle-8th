<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ex 페이지</title>
</head>

<body>
    <div id="content">
        <h1>안녕하세요, 인증된 사용자입니다!</h1>
    </div>

    <script>
        // 페이지 로드 시, JWT 토큰이 로컬 스토리지에 있는지 확인
        const token = localStorage.getItem("jwt_token");

        if (!token) {
            alert("인증되지 않은 사용자입니다. 로그인 후 다시 시도해주세요.");
            window.location.href = "index.html"; // 로그인 페이지로 리디렉션
        }

        // 서버에 토큰을 보내서 유효한지 확인하는 API 호출
        fetch("http://localhost:5001/protected", {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + token,
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.result === "error") {
                alert("인증이 실패했습니다.");
                window.location.href = "index.html"; // 로그인 페이지로 리디렉션
            }
        })
        .catch(error => {
            console.error("인증 오류:", error);
            alert("인증 오류가 발생했습니다.");
            window.location.href = "index.html"; // 로그인 페이지로 리디렉션
        });
    </script>

</body>

</html>